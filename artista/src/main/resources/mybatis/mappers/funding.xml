<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
							"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mulcam.artista.dao.FundingDAO">
	<!-- 작가가 펀딩 신청 -->
	<insert id="insertApply" parameterType="funding" >
		<![CDATA[
			insert into fundingapp(artistNo, id, projTitle, projIntro, projBudget, projArtist, targetFunding, fundingDate, startDate, endDate, thumbImg, applyStatus, getplace, getplace2, applydate)
			values((select artistNo from artist where id=#{id}), #{id}, #{projTitle}, #{projIntro}, #{projBudget}, #{projArtist}, #{targetFunding}, #{fundingDate}, #{startDate}, #{endDate}, #{thumbImg}, 0, #{getplace}, #{getplace2}, sysdate())
		]]>
	</insert>
	<insert id="insertupdate" parameterType="funding" >
		<![CDATA[
			insert into fundingapp(artistNo, id, projTitle, projIntro, projBudget, projArtist, targetFunding, fundingDate, startDate, endDate, thumbImg, applyStatus, getplace, getplace2, applydate)
			values((select artistNo from artist where id=#{id}), #{id}, #{projTitle}, #{projIntro}, #{projBudget}, #{projArtist}, #{targetFunding}, #{fundingDate}, #{startDate}, #{endDate}, #{thumbImg}, 1, #{getplace}, #{getplace2}, sysdate())
		]]>
	</insert>
	
	<select id="queryFunding" parameterType="string" resultType="Funding">
		<![CDATA[
			select * from fundingapp where id=#{id}
		]]>
	</select>
	<update id="updatefundingapp" parameterType="Funding" >
		<![CDATA[
			update fundingapp set projTitle=#{projTitle}, projIntro=#{projIntro}, projBudget=#{projBudget}, projArtist=#{projArtist}, targetFunding=#{targetFunding},
			fundingDate=#{fundingDate}, startDate=#{startDate}, endDate=#{endDate}, thumbImg=#{thumbImg}, getplace=#{getplace}, getplace2=#{getplace2} where id=#{id}
		]]>
	</update>
		<update id="updateapplyStatus" parameterType="Funding" >
		<![CDATA[
			update fundingapp set applyStatus=1 where id=#{id}
		]]>
	</update>
	<insert id="insertfunding" parameterType="funding" >
		<![CDATA[
			insert into funding(fundingNo, artistNo, id, projTitle, projIntro, projBudget, projArtist, targetFunding, fundingDate, startDate, endDate, thumbImg, sumAmount, fundingState, getplace)
			values(#{fundingNo}, #{artistNo},#{id}, #{projTitle}, #{projIntro}, #{projBudget}, #{projArtist}, #{targetFunding}, #{fundingDate}, #{startDate}, #{endDate}, #{thumbImg}, #{sumAmount}, 0, #{getplace})
		]]>
	</insert>
	<update id="updatefundingState" parameterType="Funding" >
		<![CDATA[
			update funding set fundingState=(case when timestampdiff(hour, now(), startDate)>0 then 1 else 
		(case when timestampdiff(hour, now(), endDate)>0 then 2 else 3 end) end)
		]]>
	</update>
	<select id="queryuc" resultType="Funding">
		<![CDATA[
			select * from funding where fundingState=1
		]]>
	</select>
	<select id="queryov" resultType="Funding">
		<![CDATA[
			select * from funding where fundingState=2
		]]>
	</select>
	<select id="querytm" resultType="Funding">
		<![CDATA[
			select * from funding where fundingState=3
		]]>
	</select>
</mapper>

<!-- 
create table fundingApp(
	fundingNo int(10) not null auto_increment,
    artistNo int(10),
    id varchar(100) not null,
    projTitle varchar(100) not null,
    projIntro varchar(255) not null,
    projBudget varchar(255) not null,
    projArtist varchar(255) not null,
    targetFunding int(100) not null,
    fundingDate varchar(255),
    startDate timestamp,
    endDate timestamp,
    thumbImg varchar(100) not null,
    applyStatus int(10),
    refusedContents varchar(500),
    getplace varchar(500) not null,
    getplace2 varchar(255),
    applydate date,
    primary key(fundingNo)
);

create table funding(
	fundingNo int(10) not null,
    artistNo int(10) not null,
	id varchar(100) not null,
    projTitle varchar(100) not null,
    projIntro varchar(255) not null,
    projBudget varchar(255) not null,
    projArtist varchar(255) not null,
    targetFunding int(100) not null,
    fundingDate varchar(255),
    startDate timestamp,
    endDate timestamp,
    thumbImg varchar(100) not null,
	sumAmount int(10),
    fundingState int(10),
    getplace varchar(500) not null,
    getplace2 varchar(255),
    primary key(fundingNo)
);

create table fundingSpon(
	sponsorNo int(10) not null,
    id varchar(100) not null,
    fundingNo int(10) not null,
    sponsorAmount int(10) not null,
    email varchar(100) not null,
    primary key(sponsorNo)
);

알림 테이블은 나중에

 -->
 
 